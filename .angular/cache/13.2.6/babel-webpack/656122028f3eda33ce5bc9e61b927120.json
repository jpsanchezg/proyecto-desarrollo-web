{"ast":null,"code":"import _asyncToGenerator from \"C:\\\\Users\\\\juanp\\\\Documents\\\\github\\\\proyecto-desarrollo-web\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";\nimport { User } from 'src/app/model/user';\nimport { environment } from 'src/environments/environment';\nimport { Purchase } from 'src/app/model/purchase';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class UserControllerService {\n  constructor(http) {\n    this.http = http;\n    this.currentUser = null;\n    this.listUsers = [];\n  }\n\n  login(username, password) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        var responseBody = yield _this.http.post(`${environment.baseURL}/login`, {\n          username: username,\n          password: password\n        }, {\n          responseType: \"text\"\n        }).toPromise();\n        window.sessionStorage.setItem(\"jwt\", responseBody);\n        yield _this.getUserByUsername(username).then(value => {\n          _this.currentUser = value;\n        });\n        return true;\n      } catch (e) {\n        console.error(e);\n        _this.currentUser = null;\n        return false;\n      }\n    })();\n  }\n\n  addUser(name, username, password) {\n    try {\n      this.http.post(`${environment.baseURL}/user/create`, {\n        username: username,\n        password: password,\n        name: name\n      }).toPromise();\n    } catch (e) {\n      console.error(e);\n      return false;\n    }\n\n    return true;\n  }\n\n  modUser(name, username, password, shoppingCart) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      var body = {\n        username: username,\n        name: name,\n        password: password,\n        shoppingCart: shoppingCart\n      };\n      console.log(body);\n      yield _this2.http.put(`${environment.baseURL}/user/update`, body).toPromise();\n    })();\n  }\n\n  getCurrentUser() {\n    return this.currentUser;\n  }\n\n  getAllUsers() {\n    return this.listUsers;\n  }\n\n  getUserByUsername(username) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      var user = new User();\n\n      try {\n        var json = yield _this3.http.get(`${environment.baseURL}/user/${username}`).toPromise();\n        user.setUsername(json.username);\n        user.setName(json.name);\n        user.setIsAdmin(json.admin);\n        var shoppingCart = json.shoppingCart;\n        shoppingCart.forEach(element => {\n          var purchase = new Purchase(element.productId, element.quantity);\n          purchase.setId(element.id);\n          user.addPurchaseInstance(purchase);\n        });\n        return user;\n      } catch (e) {\n        console.error(e);\n      }\n\n      return null;\n    })();\n  }\n\n  removeUser(username) {\n    this.http.delete(`${environment.baseURL}/user/delete/${username}`);\n  }\n\n  logOut() {\n    this.currentUser = null;\n    window.localStorage.removeItem(\"jwt\");\n  }\n\n}\n\nUserControllerService.ɵfac = function UserControllerService_Factory(t) {\n  return new (t || UserControllerService)(i0.ɵɵinject(i1.HttpClient));\n};\n\nUserControllerService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: UserControllerService,\n  factory: UserControllerService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["C:/Users/juanp/Documents/github/proyecto-desarrollo-web/src/app/service/user-controller/user-controller.service.ts"],"names":["User","environment","Purchase","i0","i1","UserControllerService","constructor","http","currentUser","listUsers","login","username","password","responseBody","post","baseURL","responseType","toPromise","window","sessionStorage","setItem","getUserByUsername","then","value","e","console","error","addUser","name","modUser","shoppingCart","body","log","put","getCurrentUser","getAllUsers","user","json","get","setUsername","setName","setIsAdmin","admin","forEach","element","purchase","productId","quantity","setId","id","addPurchaseInstance","removeUser","delete","logOut","localStorage","removeItem","ɵfac","UserControllerService_Factory","t","ɵɵinject","HttpClient","ɵprov","ɵɵdefineInjectable","token","factory","providedIn"],"mappings":"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","sourcesContent":["import { User } from 'src/app/model/user';\r\nimport { environment } from 'src/environments/environment';\r\nimport { Purchase } from 'src/app/model/purchase';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"@angular/common/http\";\r\nexport class UserControllerService {\r\n    constructor(http) {\r\n        this.http = http;\r\n        this.currentUser = null;\r\n        this.listUsers = [];\r\n    }\r\n    async login(username, password) {\r\n        try {\r\n            var responseBody = await this.http.post(`${environment.baseURL}/login`, { username: username, password: password }, { responseType: \"text\" }).toPromise();\r\n            window.sessionStorage.setItem(\"jwt\", responseBody);\r\n            await this.getUserByUsername(username).then(value => {\r\n                this.currentUser = value;\r\n            });\r\n            return true;\r\n        }\r\n        catch (e) {\r\n            console.error(e);\r\n            this.currentUser = null;\r\n            return false;\r\n        }\r\n    }\r\n    addUser(name, username, password) {\r\n        try {\r\n            this.http.post(`${environment.baseURL}/user/create`, { username: username, password: password, name: name }).toPromise();\r\n        }\r\n        catch (e) {\r\n            console.error(e);\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n    async modUser(name, username, password, shoppingCart) {\r\n        var body = { username: username, name: name, password: password, shoppingCart: shoppingCart };\r\n        console.log(body);\r\n        await this.http.put(`${environment.baseURL}/user/update`, body).toPromise();\r\n    }\r\n    getCurrentUser() {\r\n        return this.currentUser;\r\n    }\r\n    getAllUsers() {\r\n        return this.listUsers;\r\n    }\r\n    async getUserByUsername(username) {\r\n        var user = new User();\r\n        try {\r\n            var json = await this.http.get(`${environment.baseURL}/user/${username}`).toPromise();\r\n            user.setUsername(json.username);\r\n            user.setName(json.name);\r\n            user.setIsAdmin(json.admin);\r\n            var shoppingCart = json.shoppingCart;\r\n            shoppingCart.forEach((element) => {\r\n                var purchase = new Purchase(element.productId, element.quantity);\r\n                purchase.setId(element.id);\r\n                user.addPurchaseInstance(purchase);\r\n            });\r\n            return user;\r\n        }\r\n        catch (e) {\r\n            console.error(e);\r\n        }\r\n        return null;\r\n    }\r\n    removeUser(username) {\r\n        this.http.delete(`${environment.baseURL}/user/delete/${username}`);\r\n    }\r\n    logOut() {\r\n        this.currentUser = null;\r\n        window.localStorage.removeItem(\"jwt\");\r\n    }\r\n}\r\nUserControllerService.ɵfac = function UserControllerService_Factory(t) { return new (t || UserControllerService)(i0.ɵɵinject(i1.HttpClient)); };\r\nUserControllerService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: UserControllerService, factory: UserControllerService.ɵfac, providedIn: 'root' });\r\n"]},"metadata":{},"sourceType":"module"}